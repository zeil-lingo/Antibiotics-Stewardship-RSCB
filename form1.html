<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Permintaan Antimikroba RSCB</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js" integrity="sha512-z8IYLHO8bTgFqj+yrPyIJnzBDf7DDhWwiEsk4sY+Oe6J2M+WQequeGS7qioI5vT6rXgVRb4K1UVQC5ER7MKzKQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/downloadjs/1.4.8/download.min.js" integrity="sha512-WiGQZv8WpmQVRUFXZywo7pHIO0G/o3RyiAJZj8YXNN4AV7ReR1RYWVmZJ6y3H06blPcjJmG/sBpOVZjTSFFlzQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  </head>
  
  <body>
    <section class="hero">
      <div class="hero-header">
        <div class="section has-text-centered">
            <a class="center" href="https://ibb.co.com/ZVjH49t"><img src="https://i.ibb.co.com/ZVjH49t/Stempel-PPRA.png" alt="Stempel-PPRA" border="0"></a>
            <br>
            <br>
            <p class="title is-4">Formulir Permintaan Antimikroba <i>Access</i> dan <i>Reserve</i>
            <p class="subtitle">Rumah Sakit St. Carolus Borromeus - RSCB Kupang</h1></p>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="columns is-centered">
      <div class="box">
            <form id="form" class="container m-2 pl-2" method="POST">

                <div class="field">
                    <label class="label">Nama DPJP:</label>
                    <div class="control">
                        <input class="input" type="text" name="nama_dpjp" id="nama_dpjp_input" list="nama_dpjp_options">
                        <datalist id="nama_dpjp_options">
                            <option value="dr_danny_darmawan">dr. Danny Darmawan, Sp. PD</option>
                            <option value="dr_heri_sutrisno">dr. Heri Sutrisno, Sp.PD - KHO</option>
                            <option value="dr_jefri">dr. Jefri, Sp.PD</option>
                            <option value="dr_stefany_adi">dr. Stefany Adi W., Sp.PD - KGH</option>
                            <option value="dr_marlon">dr. Marlon, Sp.An TI</option>
                            <option value="dr_telly_victorya">dr. Telly Victorya Kapitana, Sp.An TI</option>
                            <option value="dr_samlek_sunbanu">dr. Samlek E. Sunbanu, Sp.A</option>
                            <option value="dr_simplicia_m">Dr. dr. Simplicia M. A., Sp.A (K)</option>
                            <option value="dr_tjahyo_s">dr. Tjahyo S., SpA</option>
                            <option value="dr_setijo_halim">dr. Setijo Halim, Sp.B</option>
                            <option value="dr_frida_silitonga">dr. Frida M. Silitonga, Sp.S</option>
                            <option value="dr_olivia_wijaya">dr. Olivia J. Wijaya, Sp.N</option>
                            <option value="dr_niva_wilujeng">dr. Niva Wilujeng, Sp. JP</option>
                            <option value="dr_kristian_ratu">dr. Kristian Ratu, Sp.OG</option>
                            <option value="dr_trisna_turwewi">dr. N. Trisna T. K. Turwewi, Sp. THT- KL</option>
                            <option value="dr_made_tambunan">dr. Made P. Tambunan, Sp.U</option>
                            <option value="dr_arian_d">dr. R. Arian D., Sp.BP-RE</option>
                            <option value="dr_andre_sinambela">dr. Andre Tongam Palopor Sinambela, Sp. EM</option>
                            <option value="drg_ellen_p">drg. Ellen S. P., SpBM</option>
                            <option value="drg_revina_marpaung">drg. Revina Marpaung, SpKG</option>
                        </datalist>
                    </div>
                </div>

            <div class="field">
                <label class="label">Nama Pasien:</label>
                <div class="control">
                    <input 
                    type="text" 
                    class="input" 
                    name="nama_pasien" 
                    />
                </div>
            </div>

            <div class="field">
                <label class="label">Ruangan:</label>
                <div class="control">
                    <div class="select">
                        <select name="ruangan" class="input">
                            <option value="IGD">IGD</option>
                            <option value="ICU">ICU</option>
                            <option value="Poli">Poli</option>
                            <option value="Carolus Tim 1">Carolus Tim 1</option>
                            <option value="Carolus Tim 2">Carolus Tim 2</option>
                            <option value="Lukas">Lukas</option>
                            <option value="Lukas - Isolasi">Lukas - Isolasi</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="field">
                <label class="label">No. Rekam Medis:</label>
                <div class="control">
                    <input 
                    type="text" 
                    class="input" 
                    name="no_rekam_medis">
                </div>
            </div>

            <div class="field">
                <label class="label">Tanggal Lahir:</label>
                <div class="control">
                    <input type="date" class="input" name="tanggal_lahir">
                </div>
            </div>

            <div class="field">
                <label class="label">Jenis Kelamin:</label>
                <div class="control">
                    <label class="radio">
                        <input type="radio" name="jenis_kelamin" value="L" required> L
                    </label>
                    <label class="radio">
                        <input type="radio" name="jenis_kelamin" value="P" required> P
                    </label>
                </div>
            </div>

            <div class="field">
                <label class="label">Berat Badan:</label>
                <div class="control">
                    <input 
                    type="number" 
                    class="input" 
                    name="berat_badan" 
                    step="0.1"
                    placeholder="Dalam Kg">
                </div>
            </div>

            <div class="field">
                <label class="label">Tanggal MRS:</label>
                <div class="control">
                    <input type="date" class="input" name="tanggal_mrs">
                </div>
            </div>

            <div class="field">
                <label class="label">Diagnosis:</label>
                <div class="control">
                    <textarea class="textarea" name="diagnosis"></textarea>
                </div>
            </div>

            <div class="field">
                <label class="label">Keadaan Umum:</label>
                <div class="control">
                    <input type="text" class="input" name="keadaan_umum">
                </div>
            </div>

            <div class="field">
            <label class="label">Tanda Vital:</label>
            <table class="table is-bordered is-fullwidth">
                <thead>
                    <tr>
                        <th>Tanda Vital</th>
                        <th>Pertama</th>
                        <th>Kemarin</th>
                        <th>Hari Ini</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Tekanan Darah</td>
                        <td><input type="text" class="input" name="tekanan_darah_pertama"></td>
                        <td><input type="text" class="input" name="tekanan_darah_kemarin"></td>
                        <td><input type="text" class="input" name="tekanan_darah_hari_ini"></td>
                    </tr>

                    <tr>
                        <td>Nadi</td>
                        <td><input type="text" class="input" name="nadi_pertama"></td>
                        <td><input type="text" class="input" name="nadi_kemarin"></td>
                        <td><input type="text" class="input" name="nadi_hari_ini"></td>
                    </tr>

                    <tr>
                        <td>RR</td>
                        <td><input type="text" class="input" name="rr_pertama"></td>
                        <td><input type="text" class="input" name="rr_kemarin"></td>
                        <td><input type="text" class="input" name="rr_hari_ini"></td>
                    </tr>
                
                    <tr>
                        <td>Suhu</td>
                        <td><input type="text" class="input" name="suhu_pertama"></td>
                        <td><input type="text" class="input" name="suhu_kemarin"></td>
                        <td><input type="text" class="input" name="suhu_hari_ini"></td>
                    </tr>
                </tbody>
            </table>
            </div>

            <div class="field">
                <label class="label">Kondisi saat ini:</label>
                <div class="control">
                    <textarea class="textarea" name="kondisi_saat_ini"></textarea>
                </div>
            </div>

            <div class="field">
                <label class="label">Penyakit Penyerta:</label>
                <div class="control">
                    <textarea class="textarea" name="penyakit_penyerta"></textarea>
                </div>
            </div>

            <div class="field">
                <label class="label">Pasien Rujukan:</label>
                <div class="control">
                    <label class="checkbox">
                        <input type="checkbox" name="pasien_rujukan" value="Ya">
                        Ya
                    </label>
                    <label class="checkbox">
                        <input type="checkbox" name="pasien_rujukan" value="Tidak">
                        Tidak
                    </label>
                </div>
            </div>

            <div class="field">
                <label class="label">Nama RS:</label>
                <div class="control">
                    <input type="text" class="input" name="nama_rs">
                </div>
            </div>

            <div class="field">
                <label class="label">Riwayat Antimikroba sebelumnya / saat ini:</label>
                <div class="control">
                    <label class="checkbox">
                        <input type="checkbox" name="riwayat_antimikroba" value="Ya">
                        Ya
                    </label>
                    <label class="checkbox">
                        <input type="checkbox" name="riwayat_antimikroba" value="Tidak">
                        Tidak
                    </label>
                </div>
            </div>

            <h4>Antimikroba</h4>
            <table class="table is-bordered is-fullwidth">
                <thead>
                    <tr>
                        <th>Antimikroba</th>
                        <th>Keterangan</th>
                        <th>Stop Tanggal</th>
                        <th>Lama Pemakaian</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" class="input" name="antimikroba_1"></td>
                        <td><input type="text" class="input" name="keterangan_1"></td>
                        <td><input type="date" class="input" name="stop_tanggal_1"></td>
                        <td><input type="text" class="input" name="lama_pemakaian_1"></td>
                    </tr>

                    <tr>
                        <td><input type="text" class="input" name="antimikroba_2"></td>
                        <td><input type="text" class="input" name="keterangan_2"></td>
                        <td><input type="date" class="input" name="stop_tanggal_2"></td>
                        <td><input type="text" class="input" name="lama_pemakaian_2"></td>
                    </tr>

                    <tr>
                        <td><input type="text" class="input" name="antimikroba_3"></td>
                        <td><input type="text" class="input" name="keterangan_3"></td>
                        <td><input type="date" class="input" name="stop_tanggal_3"></td>
                        <td><input type="text" class="input" name="lama_pemakaian_3"></td>
                    </tr>
                </tbody>
            </table>

            <div class="field">
            <label class="label">Permintaan Antimikroba</label>
            <table class="table is-bordered is-fullwidth">
                <thead>
                    <tr>
                        <th></th>
                        <th>Antimikroba 1</th>
                        <th>Antimikroba 2</th>
                        <th>Antimikroba 3</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Nama Antimikroba</td>
                        <td><input type="text" class="input" name="nama_antimikroba_1"></td>
                        <td><input type="text" class="input" name="nama_antimikroba_2"></td>
                        <td><input type="text" class="input" name="nama_antimikroba_3"></td>
                    </tr>
                    <!-- Repeat similar rows for other antimicrobials -->
                </tbody>
            </table>
            </div>

            <!-- Continue replacing remaining fields with Bulma classes as needed -->


            <h4>Laboratorium Mikrobiologi saat ini</h4>
            <div class="field">
                <label class="label">Hasil Kultur:</label>
                <div class="control">
                    <label class="checkbox">
                        <input class="checkbox" type="checkbox" name="hasil_kultur" value="Ada">
                        Ada, lampirkan copy hasil kultur
                    </label>
                    <label class="checkbox">
                        <input class="checkbox" type="checkbox" name="hasil_kultur" value="Tidak Ada">
                        Tidak Ada
                    </label>
                </div>
            </div>

            <div class="field">
                <label class="label">Dikirim tanggal:</label>
                <div class="control">
                    <input type="date" class="input" name="dikirim_tanggal">
                </div>
            </div>

            <table class="table is-bordered is-fullwidth">
                <thead>
                    <tr>
                        <th>Tanggal Kultur</th>
                        <th>Spesimen</th>
                        <th>Hasil</th>
                        <th>Resisten / Intermediate / Sensitif</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="date" class="input" name="tanggal_kultur_1"></td>
                        <td><input type="text" class="input" name="spesimen_1"></td>
                        <td><input type="text" class="input" name="hasil_1"></td>
                        <td><input type="text" class="input" name="ris_1"></td>
                    </tr>
                    <!-- Repeat similar rows for other samples -->
                </tbody>
            </table>

            <h4>Hasil Laboratorium</h4>
            <table class="table is-bordered is-fullwidth">
                <thead>
                    <tr>
                        <th>Pemeriksaan</th>
                        <th>Tanggal</th>
                        <th>Tanggal</th>
                        <th>Tanggal</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Darah Lengkap</td>
                        <td><input type="date" class="input" name="darah_lengkap_1"></td>
                        <td><input type="date" class="input" name="darah_lengkap_2"></td>
                        <td><input type="date" class="input" name="darah_lengkap_3"></td>
                    </tr>
                    <!-- Repeat similar rows for other examinations -->
                </tbody>
            </table>

            <h4>Hasil Pemeriksaan Radiologi / Penunjang lain</h4>
            <table class="table is-bordered is-fullwidth">
                <thead>
                    <tr>
                        <th>Pemeriksaan</th>
                        <th>Tanggal</th>
                        <th>Hasil</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" class="input" name="pemeriksaan_radiologi_1"></td>
                        <td><input type="date" class="input" name="tanggal_radiologi_1"></td>
                        <td><input type="text" class="input" name="hasil_radiologi_1"></td>
                    </tr>
                    <!-- Repeat similar rows for other radiological examinations -->
                </tbody>
            </table>

                <div class="field is-grouped">
                    <div class="control">
                    <button class="button is-primary" type="submit" id="submit-button" onclick="fillForm()">
                        Submit
                    </button>
                    </div>
                </div>
                </form>
                <div
                id="message"
                style="
                    display: none;
                    margin: 20px;
                    font-weight: bold;
                    color: green;
                    padding: 8px;
                    background-color: beige;
                    border-radius: 4px;
                    border-color: aquamarine;
                "
                ></div>

            </div>
            </form>
      </div>
      </div>
    </div>
    </section>

    
    <script>

    document.getElementById('nama_dpjp_input').addEventListener('input', function(event) {
        var input = event.target;
        var datalist = document.getElementById(input.getAttribute('list'));
        var options = datalist ? Array.from(datalist.options) : [];

        var selectedOption = options.find(function(option) {
            return option.value === input.value;
        });

        if (selectedOption) {
            input.value = selectedOption.textContent;
        }
    });
      
      document.getElementById("form").addEventListener("submit", function (e) {
        e.preventDefault(); // Prevent the default form submission
        document.getElementById("message").textContent = "Submitting..";
        document.getElementById("message").style.display = "block";
        document.getElementById("submit-button").disabled = true;

        // Collect the form data
        var formData = new FormData(this);
        var keyValuePairs = [];
        for (var pair of formData.entries()) {
          keyValuePairs.push(pair[0] + "=" + pair[1]);
        }

        var formDataString = keyValuePairs.join("&");

        // Send a POST request to your Google Apps Script
        fetch(
          "https://script.google.com/macros/s/AKfycbwLzMeytVZEpkf2XPIJTbtu5W1xxR7wXzYeH_aiPfQVZmZ-YvYztAttZGxPww8l3hIk/exec",
          { mode: 'no-cors'
            redirect: "follow",
            method: "POST",
            body: formDataString,
            headers: {
              "Content-Type": "text/plain;charset=utf-8",
            },
          }
        )
          .then(function (response) {
            // Check if the request was successful
            if (response) {
              return response; // Assuming your script returns JSON response
            } else {
              throw new Error("Failed to submit the form.");
            }
          })
          .then(function (data) {
            // Display a success message
            document.getElementById("message").textContent =
              "Data submitted successfully!";
            document.getElementById("message").style.display = "block";
            document.getElementById("message").style.backgroundColor = "green";
            document.getElementById("message").style.color = "beige";
            document.getElementById("submit-button").disabled = false;
            document.getElementById("form").reset();

            setTimeout(function () {
              document.getElementById("message").textContent = "";
              document.getElementById("message").style.display = "none";
            }, 2600);
          })
          .catch(function (error) {
            // Handle errors, you can display an error message here
            console.error(error);
            document.getElementById("message").textContent =
              "Sudah tersubmit! Mohon di-periksa kembali statusnya";
            document.getElementById("message").style.display = "block";
          });
      });
    </script>

<script>
    const { PDFDocument } = PDFLib

    function updateVariables() {
            var nama_dpjp = document.getElementById('nama_dpjp_input').value;
            var nama_pasien = document.getElementById('nama_pasien').value;
            var ruangan = document.getElementById('ruangan').value;
            var no_rekam_medis   = document.getElementById('no_rekam_medis').value;
            var tanggal_lahir = document.getElementById('tanggal_lahir').value;
            var jenis_kelamin = document.getElementById('jenis_kelamin').value;
            var berat_badan = document.getElementById('berat_badan').value;

    }

    async function fillForm() {
    	// Fetch the PDF with form fields
      const formUrl = 'https://github.com/zeil-lingo/Antibiotics-Stewardship-RSCB/blob/824fd0bc10873b929c895ee0f8ecdb5e9261b889/V0.23%20Permintaan%20Antibiotik.pdf'
      const formPdfBytes = await fetch(formUrl).then(res => res.arrayBuffer())

      // Load a PDF with form fields
      const pdfDoc = await PDFDocument.load(formPdfBytes)

      // Get the form containing all the fields
      const form = pdfDoc.getForm()

      // Get all fields in the PDF by their names
      const pdf_nama_dpjp = form.getTextField('nama_dpjp')
      const pdf_nama_pasien = form.getTextField('nama_pasien')
      const pdf_ruangan = form.getTextField('ruangan')
      const pdf_rekam_medis = form.getTextField('no_rekam_medis')
      const pdf_lahir = form.getTextField('tanggal_lahir')
      const pdf_kelamin = form.getTextField('jenis_kelamin')
      const pdf_berat_badan = form.getTextField('berat_badan')

      // Fill in the basic info fields
      pdf_nama_dpjp.setText(nama_dpjp)
      pdf_nama_pasien.setText(nama_pasien)
      pdf_ruangan.setText(ruangan)
      pdf_rekam_medis.setText(no_rekam_medis)
      pdf_lahir.setText(tanggal_lahir)
      pdf_kelamin.setText(jenis_kelamin)
      pdf_berat_badan.setText(berat_badan)

      // Serialize the PDFDocument to bytes (a Uint8Array)
      const pdfBytes = await pdfDoc.save()

	   // Trigger the browser to download the PDF document
      download(pdfBytes, "pdf-lib_form_creation_example.pdf", "application/pdf");
    }
  </script>

  </body>

<footer class="footer m-0 p-2 pl-4 has-text-centered">
    <p>
        zekordavar lavadka rimba
    </p>
</footer>
  
</html>